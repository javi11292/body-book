(this["webpackJsonpbody-book"]=this["webpackJsonpbody-book"]||[]).push([[7],{167:function(e,t,a){"use strict";var r=a(0),n=a.n(r),c=a(207);var o=n.a.memo((function(e){return n.a.createElement(c.a,Object.assign({variant:"filled"},e))})),i=a(160);var l=n.a.memo((function(e){return n.a.createElement(i.a,Object.assign({color:"primary"},e))}));a.d(t,"b",(function(){return o})),a.d(t,"a",(function(){return l}))},208:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),c=a(200),o=a(201),i=a(209),l=a(196),u=a(206),s=a(79),f=a(166),b=a(132),m=a(198),O=a(167),d=Object(f.a)("div")({height:"100%",width:"100%",display:"grid",gridTemplateRows:"1fr auto"}),v=Object(f.a)(O.b)({margin:"0.5rem"}),j=Object(f.a)("div")({overflowY:"auto",wordBreak:"break-word",display:"flex",flexDirection:"column",margin:"0.25rem"}),p=Object(f.a)((function(e){e.read,e.received;var t=Object(s.a)(e,["read","received"]);return n.a.createElement(m.a,t)}))((function(e){var t=e.read;return{position:"relative",visibility:e.received&&!1!==t?void 0:"hidden",gridArea:"icon",top:t?"0.28rem":void 0}})),h=Object(f.a)((function(e){e.local;var t=Object(s.a)(e,["local"]);return n.a.createElement(b.a,t)}))((function(e){var t=e.local;return{position:"relative",borderRadius:"1rem",display:"inline",margin:"0.25rem",padding:"1rem",alignSelf:t?"flex-end":"flex-start",backgroundColor:t?"#FFFF80":"inherit"}})),g=Object(f.a)("span")({position:"absolute",bottom:"0.5rem",right:"0.75rem",fontSize:"0.75rem",color:"grey"}),y=Object(f.a)("span")({width:"3.5rem",display:"inline-block"}),E=Object(f.a)("span")({position:"relative",display:"inline-grid",gridTemplateAreas:"icon",marginLeft:"0.1rem"}),w=a(19),C=a(58),k=a(37);var P=function(){var e=Object(k.a)("chats"),t=Object(w.a)(e,1)[0],a=Object(k.a)("activeChat"),n=Object(w.a)(a,1)[0];return Object(r.useMemo)((function(){return Object.values(t[n.username]||{})}),[t,n])};var S=function(){var e=Object(r.useRef)(),t=Object(r.useRef)(!1),a=Object(r.useState)(""),n=Object(w.a)(a,2),c=n[0],o=n[1],i=Object(k.a)("activeChat"),l=Object(w.a)(i,1)[0],u=Object(k.a)("chats",!1),s=Object(k.a)("user"),f=Object(w.a)(s,1)[0],b=P();return Object(r.useEffect)((function(){b.forEach((function(e){e.received&&!e.read&&f===e.to&&C.a.emit("read",e)}))}),[b,u,f]),Object(r.useLayoutEffect)((function(){t.current||(e.current.scrollTop=e.current.scrollHeight-e.current.offsetHeight)}),[b]),{user:f,handleScroll:function(e){var a=e.currentTarget,r=a.scrollHeight,n=a.scrollTop,c=a.offsetHeight;t.current=n!==r-c},chatRef:e,handleKeyDown:function(e){var t=e.key;c&&"Enter"===t&&(C.a.emit("message",{to:l.username,message:c}),o(""))},message:c,handleChange:function(e){var t=e.target;o(t.value)},chat:b}};var D=n.a.memo((function(){var e=S(),t=e.user,a=e.handleScroll,r=e.chatRef,c=e.handleKeyDown,o=e.message,i=e.handleChange,l=e.chat;return n.a.createElement(d,null,n.a.createElement(j,{onScroll:a,ref:r},l.map(function(e){return function(t,a){var r=t.from,c=t.message,o=t.received,i=t.read,l=t.date;return n.a.createElement(h,{local:r===e,key:a},c,n.a.createElement(y,null),n.a.createElement(g,null,Object(u.a)(l,"HH:mm"),n.a.createElement(E,null,e===r&&n.a.createElement(p,{fontSize:"inherit",received:o}),e===r&&n.a.createElement(p,{fontSize:"inherit",received:o,read:i}))))}}(t))),n.a.createElement(v,{autoComplete:"off",label:"Mensaje",margin:"normal",variant:"outlined",value:o,onChange:i,onKeyDown:c}))})),z=a(199),R=Object(f.a)("div")({height:"100%",width:"100%"}),T=Object(f.a)(z.a)({overflow:"hidden"}),x=a(22),H=a.n(x),F=a(36),B=a(39),K=a(56);function A(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function J(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?A(a,!0).forEach((function(t){Object(B.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):A(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var L=function(){var e=Object(k.a)("contacts"),t=Object(w.a)(e,2),a=t[0],n=t[1],c=Object(k.a)("activeChat"),o=Object(w.a)(c,2),i=o[0],l=o[1],u=Object(k.a)("chats"),s=Object(w.a)(u,1)[0],f=Object(k.a)("user"),b=Object(w.a)(f,1)[0],m=Object(r.useState)({}),O=Object(w.a)(m,2),d=O[0],v=O[1];return Object(r.useEffect)((function(){var e=Object.entries(s).reduce((function(e,t){var a=Object(w.a)(t,2),r=a[0],n=a[1],c=Object.values(n).reduce((function(e,t){return b===t.from||t.read?J({},e,{last:t.message}):{last:t.message,size:e.size+1}}),{size:0});return J({},e,Object(B.a)({},r,c))}),{});v(e)}),[s,b]),Object(r.useEffect)((function(){function e(){return(e=Object(F.a)(H.a.mark((function e(){var t,a;return H.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(K.a)("/user/contacts");case 2:t=e.sent,a=t.message,n(a);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}a||function(){e.apply(this,arguments)}()}),[a,n]),{activeChat:i,selectContact:function(e){var t=e.currentTarget;l({open:!0,username:t.dataset.value})},contacts:a,newChats:d}};var M=n.a.memo((function(){var e=L(),t=e.contacts,a=e.selectContact,r=e.activeChat,u=e.newChats;return n.a.createElement(R,null,r.open?n.a.createElement(D,null):n.a.createElement(l.a,null,t&&t.map(function(e){var t=e.selectContact,a=e.newChats;return function(e){var r=e.username,l=a[r]||{last:n.a.createElement("span",null,"\xa0"),size:0};return n.a.createElement(c.a,{button:!0,onClick:t,"data-value":r,key:r},n.a.createElement(T,{primary:r,secondary:l.last}),n.a.createElement(o.a,null,l.size>0&&n.a.createElement(i.a,{label:l.size,color:"primary"})))}}({selectContact:a,newChats:u}))))})),Y=a(55),q=a(203),G=a(204),I=a(205),N=a(202),Q=Object(f.a)("div")({height:"100%",width:"100%",position:"absolute",display:"grid",gridTemplateRows:"auto 1fr",overflow:"hidden"}),U=Object(f.a)("div")((function(e){e.theme;return{width:"100%",overflow:"auto"}})),V=Object(f.a)(N.a)({marginRight:"1rem"});function W(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}var X=function(){var e=Object(k.a)("activeChat"),t=Object(w.a)(e,2),a=t[0],n=t[1],c=Object(k.a)("chats",!1),o=Object(k.a)("user"),i=Object(w.a)(o,1)[0];return Object(r.useEffect)((function(){return C.a.connect(),C.a.on("message",(function(e){c({user:i,message:e})})),function(){C.a.off("message"),C.a.disconnect()}}),[i,c]),{activeChat:a,closeChat:function(){n(function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?W(a,!0).forEach((function(t){Object(B.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):W(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({},a,{open:!1}))}}};function Z(e){var t=e.children;return n.a.createElement(Y.a,{variant:"h6"},t)}t.default=n.a.memo((function(){var e=X(),t=e.activeChat,a=e.closeChat;return n.a.createElement(Q,null,n.a.createElement(q.a,{position:"sticky"},n.a.createElement(G.a,{variant:"dense"},t.open?n.a.createElement(n.a.Fragment,null,n.a.createElement(V,{onClick:a,edge:"start",color:"inherit"},n.a.createElement(I.a,null)),n.a.createElement(Z,null,t.username)):n.a.createElement(Z,null,"BodyBook"))),n.a.createElement(U,null,n.a.createElement(M,null)))}))}}]);
//# sourceMappingURL=7.d5dfeeca.chunk.js.map